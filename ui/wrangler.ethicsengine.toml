name = "ethicsengine-admin"
main = ".open-next/worker.js"

compatibility_date = "2026-01-20"
compatibility_flags = ["nodejs_compat", "nodejs_compat_populate_process_env"]

# Route to custom domain, disable workers.dev subdomain
workers_dev = false
preview_urls = false

[[routes]]
pattern = "admin.ethicsengine.org"
zone_name = "ethicsengine.org"
custom_domain = true

[assets]
directory = ".open-next/assets"
binding = "ASSETS"

[build]
command = "NEXT_PUBLIC_API_URL=https://api.ethicsengine.org npm run build:cf"

[observability.logs]
enabled = true

# Non-secret env vars
[vars]
AUTH_URL = "https://admin.ethicsengine.org"
NEXTAUTH_URL = "https://admin.ethicsengine.org"
AUTH_TRUST_HOST = "true"
GOOGLE_CLIENT_ID = "1003497422667-nk3s1jki6clshnvfil4r575cdlr7rnte.apps.googleusercontent.com"
NEXT_PUBLIC_API_URL = "https://api.ethicsengine.org"
ALLOWED_EMAIL_DOMAIN = "ciris.ai"

# Secrets â€” set via Cloudflare dashboard or wrangler CLI:
#   npx wrangler secret put NEXTAUTH_SECRET       (NextAuth session encryption)
#   npx wrangler secret put GOOGLE_CLIENT_SECRET   (Google OAuth)
#   npx wrangler secret put JWT_SECRET             (must match CIRISNode's JWT_SECRET for API auth)
